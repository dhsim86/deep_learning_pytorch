# Instruction

Copilot이 **Agent Mode**로 실행될 때, 모든 복잡한 작업은 **sequentialthinking MCP** 및 **memory(Knowledge Graph Memory Server) MCP** 를 통해 수행되어야 합니다. 아래 절차를 반드시 준수하세요:

---

## 1. 메모리 초기화 (Memory Retrieval)
- **항상** 챗 시작 시 `"Remembering..."`이라고 출력하며, Knowledge Graph Memory Server에서 해당 사용자(`dongho`)의 **모든 관련 메모리**를 로드합니다.  
- 이후 대화 중 메모리(`memory`)를 사용할 수 있습니다.  

---

## 2. sequentialthinking 사고 흐름 지침

### 2.1 Plan 단계 - Task 분해
- **MCP 단계1 – 계획 (Plan)**  
  - 사용자의 요청을 명확히 재진술합니다.  
  - 필요한 sub-task(예: 파일 생성, 검색, 테스트 등)를 목록화합니다.

### 2.2 Research 단계 - Context 분석
- **MCP 단계2 – 조사 (Research)**  
  - 코드베이스, 관련 문서, 외부 API(Elasticsearch, Jira 등)는 물론, **Memory**에서 관련 정보도 검색합니다.  
  - 필요한 정보(엔드포인트, 필드, 인증 방식, 메모리 연관 내용 등)를 수집하고 출력합니다.

### 2.3 Execute 단계 - 코드 실행
- **MCP 단계3 – 실행 (Execute)**  
  - 조사한 정보를 바탕으로 코드 작성/수정, 명령 실행, 외부 시스템 호출 등을 수행합니다.

### 2.4 Validate 단계 - 검증
- **MCP 단계4 – 검증 (Validate)**  
  - 단위 테스트, ESLint, 빌드, 외부 시스템 연동 결과 등을 실행하고, 성공/실패 여부를 판단합니다.

### 2.5 Iterate 단계 - 반복/피드백
- **MCP 단계5 – 반복 (Iterate)**  
  - 검증 실패 시 Plan 단계로 되돌아가 원인을 분석하고 재시도합니다.  
  - 모든 sub-task가 성공하면 결과 요약 및 사용자에게 보고합니다.

---

## 3. Knowledge Graph Memory 관리

### 3.1 사용자 식별 (User Identification)
- 상호작용 대상이 `dongho`인지 확인합니다.  
- 식별되지 않았다면 “사용자 확인 중…” 등의 메시지로 확인을 시도합니다.

### 3.2 Memory 관찰 및 수집
- 대화 중 다음 범주에 해당하는 새로운 정보를 감지하면, 즉시 Memory에 반영합니다:  
  a) 기본 신상(직업, 지역, 역할 등)  
  b) 행동 패턴(관심사, 습관 등)  
  c) 의사소통/언어 선호  
  d) 목표 및 도전 과제  
  e) 관계(개인·업무 관계 등, 최대 3단계 이내)

### 3.3 Memory 저장 업데이트
- 새로운 정보가 감지되면, 아래 형식으로 Memory에 기록합니다:
  - **엔티티 생성**: 주요 조직, 인물, 이벤트 등의 반복 등장 객체  
  - **관계 생성**: 엔티티 간 의미 있는 연관성  
  - **Observation 기록**: 엔티티에 대한 사실 기반의 관찰 내용

---

## 4. 전체 지침 요약 체크리스트
- [ ] Memory 초기화 및 로드 (`"Remembering..."`)  
- [ ] Plan → Research → Execute → Validate → Iterate 단계 완전 준수  
- [ ] Plan에서 반드시 sub-task 목록 작성  
- [ ] Research 단계에서 Memory와 외부 컨텍스트 모두 분석  
- [ ] Execute 단계에서 자율적 코드/도구 호출 수행  
- [ ] Validate 단계에서 빌드·테스트·결과 분석  
- [ ] Iterate 단계에서 실패 시 원인 재분석・재시도, 성공 시 보고  
- [ ] 대화 중 새로운 정보 발견 즉시 Memory에 반영

---

## 5. MCP 도구별 참고
### github

- 다음과 같은 owner가 소유한 레포지토리에 자주 접근합니다.
  - MediaPlatform
  - MainMediaPlatform
- PR 리뷰 시 approve/request changes 하지 말고, 코멘트만 남깁니다.  
- 중요한 수정이 필요하면 해당 위치에 코멘트를 추가합니다.
- 코멘트 끝에 `"generated by copilot"`을 명시합니다.

### elasticsearch

* 사용자는 한국 시간대(KST)를 사용한다.
* **먼저 elasticsearch의 인덱스 구조 및 매핑 정보를 파악하고, 사용자의 요청에 따라 필요한 쿼리를 작성한다.**
* **비어있는 range 쿼리를 사용하면 에러가 발생하므로 쓰지 않는다.**

### redis

